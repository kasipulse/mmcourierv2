<div class="panel">
  <h1>Driver Tripsheets</h1>
  <select id="driverSelect">
    <option value="">--Select Driver--</option>
  </select>
  <button onclick="loadTripsheet()">Load</button>
  <table border="1" cellpadding="4" cellspacing="0" width="100%">
    <thead>
      <tr>
        <th>Waybill</th>
        <th>Recipient</th>
        <th>Address</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody id="tripsheetBody"></tbody>
  </table>
</div>

<script>
function initPanel() {
  async function loadDrivers() {
    const { data, error } = await supabase.from('drivers').select('*');
    const select = document.getElementById('driverSelect');
    data.forEach(d=>{ const opt=document.createElement('option'); opt.value=d.id; opt.text=d.name; select.add(opt); });
  }
  loadDrivers();

  window.loadTripsheet = async function() {
    const driverId=document.getElementById('driverSelect').value;
    if(!driverId) return alert('Select a driver');
    const { data, error } = await supabase.from('parcels').select('*').eq('driver_id', driverId);
    const tbody=document.getElementById('tripsheetBody');
    tbody.innerHTML='';
    data.forEach(r=>{
      const tr=document.createElement('tr');
      tr.innerHTML=`<td>${r.tracking_number}</td><td>${r.receiver}</td><td>${r.address}</td><td>${r.status}</td>`;
      tbody.appendChild(tr);
    });
  }
}
</script>
