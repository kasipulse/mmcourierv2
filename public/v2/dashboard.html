<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MM Courier | Dashboard</title>
<style>
  body {
    background: #c0c0c0;
    font-family: "Tahoma", "Segoe UI", sans-serif;
    margin: 0;
    color: #000;
    font-size: 13px;
  }
  .toolbar {
    background: #d4d0c8;
    border-bottom: 2px solid #fff;
    display: flex;
    align-items: center;
    padding: 4px;
    gap: 6px;
    flex-wrap: wrap;
    position: relative;
    z-index: 10;
  }
  .menu-btn {
    background: #e0e0e0;
    border: 2px outset #fff;
    padding: 2px 10px;
    font-size: 13px;
    cursor: pointer;
  }
  .menu-btn:active { border: 2px inset #fff; background: #d0d0d0; }
  .menu-group { position: relative; }
  .dropdown {
    display: none;
    position: absolute;
    top: 100%;
    left: 0;
    background: #d4d0c8;
    border: 2px outset #fff;
    z-index: 1000;
    min-width: 200px;
  }
  .dropdown.show { display: block; }
  .dropdown button {
    width: 100%;
    text-align: left;
    border: none;
    border-bottom: 1px solid #808080;
    background: #d4d0c8;
    padding: 4px 8px;
    font-size: 12px;
    cursor: pointer;
  }
  .dropdown button:hover { background: #b0b0b0; }
  .logout { margin-left: auto; background: #f2e5b8; }
  #content-panel { padding: 12px; }
  .panel {
    background: #d4d0c8;
    border: 2px outset #fff;
    padding: 12px;
    margin-bottom: 12px;
    box-shadow: inset 1px 1px #fff;
  }
  h1, h2, h3 { margin: 4px 0; }
  .footer {
    text-align: center;
    font-size: 11px;
    color: #333;
    border-top: 2px solid #fff;
    padding: 6px;
    background: #d4d0c8;
  }
  input, select {
    border: 2px inset #fff;
    background: #fff;
    font-size: 12px;
    padding: 3px;
  }
  button.menu-btn { min-width: 90px; }
</style>
</head>
<body>

<!-- Toolbar -->
<div class="toolbar">
  <div class="menu-group">
    <button class="menu-btn" onclick="toggleDropdown(this)">Data</button>
    <div class="dropdown">
      <button onclick="showPanel('import.html')">Import Data</button>
      <button onclick="showPanel('customers.html')">Customers</button>
      <button onclick="showPanel('drivers.html')">Drivers</button>
      <button onclick="showPanel('invoices.html')">Invoices</button>
      <button onclick="showPanel('view-waybills.html')">View Waybills</button>
    </div>
  </div>

  <div class="menu-group">
    <button class="menu-btn" onclick="toggleDropdown(this)">Tripsheets</button>
    <div class="dropdown">
      <button onclick="showPanel('tripsheet.html')">Driver Tripsheets</button>
      <button onclick="showPanel('driver-login.html')">Driver Login</button>
      <button onclick="showPanel('trip-summary.html')">Trip Sheet Summary</button>
    </div>
  </div>

  <div class="menu-group">
    <button class="menu-btn" onclick="toggleDropdown(this)">Operations</button>
    <div class="dropdown">
      <button onclick="showPanel('floorcheck.html')">Floor Check</button>
      <button onclick="showPanel('scan-in.html')">Scan In</button>
      <button onclick="showPanel('scan-out.html')">Scan Out</button>
      <button onclick="showPanel('scan-return.html')">Return to Depot</button>
      <button onclick="showPanel('collections.html')">Collections</button>
      <button onclick="showPanel('adhoc-delivery.html')">Adhoc Delivery</button>
      <button onclick="showPanel('adhoc-collection.html')">Adhoc Collection</button>
      <button onclick="showPanel('pod-upload.html')">POD Upload</button>
      <button onclick="showPanel('exceptions.html')">Scan Exceptions</button>
      <button onclick="showPanel('track.html')">Track Parcels</button>
      <button onclick="showPanel('capture-waybill.html')">Capture Waybill</button>
    </div>
  </div>

  <div class="menu-group">
    <button class="menu-btn" onclick="toggleDropdown(this)">Reports</button>
    <div class="dropdown">
      <button onclick="showPanel('daily.html')">Daily Deliveries</button>
      <button onclick="showPanel('age.html')">Age Analysis</button>
      <button onclick="showPanel('pod.html')">POD Compliance</button>
      <button onclick="showPanel('billing.html')">Billing Summary</button>
      <button onclick="showPanel('driver-performance.html')">Driver Performance</button>
      <button onclick="showPanel('client-delivery.html')">Client Delivery</button>
      <button onclick="showPanel('trip-summary.html')">Trip Sheet Summary</button>
      <button onclick="showPanel('exceptions.html')">Scan Exceptions</button>
    </div>
  </div>

  <button class="menu-btn logout" onclick="logout()">Logout</button>
</div>

<!-- Content -->
<div id="content-panel">
  <div class="panel">
    <h1>Welcome to MM Courier ERP System</h1>
    <p>Your data will appear here after login.</p>
  </div>
</div>

<!-- Footer -->
<div class="footer">Â© 2026 MM Courier Systems. All rights reserved.</div>

<!-- JS -->
<script type="module">
import { auth, db } from "/v2/js/firebase.js";
import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js";
import { collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";

const contentPanel = document.getElementById("content-panel");

onAuthStateChanged(auth, async user => {
  if (!user) {
    window.location.href = "index.html";
    return;
  }

  // Get tenant ID
  const userSnap = await getDocs(query(collection(db, "users"), where("email", "==", user.email)));
  let tenantId;
  if (!userSnap.empty) {
    tenantId = userSnap.docs[0].data().tenantId;
  } else {
    contentPanel.innerHTML = "<div class='panel' style='color:red;'>Tenant data missing!</div>";
    return;
  }

  // Load tenant waybills
  const waybillQuery = query(collection(db, "waybills"), where("tenantId", "==", tenantId));
  const waybillSnap = await getDocs(waybillQuery);

  let html = `<div class="panel"><h1>Welcome, ${user.email}</h1><h2>Your Waybills</h2><ul>`;
  waybillSnap.forEach(doc => {
    const data = doc.data();
    html += `<li>${data.wa
