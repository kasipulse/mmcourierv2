<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>MM Courier v2 | Dashboard</title>
<style>
body { background: #c0c0c0; font-family: "Tahoma","Segoe UI",sans-serif; margin:0; color:#000; font-size:13px; }
.toolbar { background: #d4d0c8; border-bottom:2px solid #fff; display:flex; align-items:center; padding:4px; gap:6px; flex-wrap:wrap; position:relative; z-index:10; }
.menu-btn { background:#e0e0e0; border:2px outset #fff; padding:2px 10px; font-size:13px; cursor:pointer; }
.menu-btn:active { border:2px inset #fff; background:#d0d0d0; }
.menu-group { position:relative; }
.dropdown { display:none; position:absolute; top:100%; left:0; background:#d4d0c8; border:2px outset #fff; z-index:1000; min-width:200px; }
.dropdown.show { display:block; }
.dropdown button { width:100%; text-align:left; border:none; border-bottom:1px solid #808080; background:#d4d0c8; padding:4px 8px; font-size:12px; cursor:pointer; }
.dropdown button:hover { background:#b0b0b0; }
.logout { margin-left:auto; background:#f2e5b8; }
#content-panel { padding:12px; }
.panel { background:#d4d0c8; border:2px outset #fff; padding:12px; margin-bottom:12px; box-shadow: inset 1px 1px #fff; }
h1,h2,h3 { margin:4px 0; }
.footer { text-align:center; font-size:11px; color:#333; border-top:2px solid #fff; padding:6px; background:#d4d0c8; }
input, select { border:2px inset #fff; background:#fff; font-size:12px; padding:3px; }
button.menu-btn { min-width:90px; }
</style>
</head>
<body>

<div class="toolbar">
  <div class="menu-group">
    <button class="menu-btn" onclick="toggleDropdown(this)">Data</button>
    <div class="dropdown">
      <button onclick="showPanel('import.html')">Import Data</button>
      <button onclick="showPanel('customers.html')">Customers</button>
      <button onclick="showPanel('drivers.html')">Drivers</button>
      <button onclick="showPanel('invoices.html')">Invoices</button>
      <button onclick="showPanel('view-waybills.html')">View Waybills</button>
    </div>
  </div>
  <div class="menu-group">
    <button class="menu-btn logout" onclick="logout()">Logout</button>
  </div>
</div>

<div id="content-panel">
  <div class="panel">
    <h1>Welcome to MM Courier ERP System</h1>
    <p>Loading tenant-specific data...</p>
  </div>
</div>

<div class="footer">© 2026 MM Courier Systems. All rights reserved.</div>

<script type="module">
import { db } from "./js/firebase.js";
import { collection, query, where, getDocs } from "./js/firebase-firestore.js";

// --- Toolbar functions ---
function logout() {
  localStorage.removeItem("tenantId");
  window.location.href = "login.html";
}

function toggleDropdown(button) {
  const dropdown = button.nextElementSibling;
  const isOpen = dropdown.classList.contains("show");
  closeAllDropdowns();
  if(!isOpen) dropdown.classList.add("show");
}

function closeAllDropdowns() {
  document.querySelectorAll(".dropdown").forEach(d => d.classList.remove("show"));
}

document.addEventListener("click", e => {
  if(!e.target.closest(".menu-group")) closeAllDropdowns();
});

// --- Load tenant-specific data ---
async function loadTenantData() {
  const tenantId = localStorage.getItem("tenantId");
  const panel = document.getElementById("content-panel");

  if(!tenantId) {
    panel.innerHTML = `<div class="panel" style="color:red;">❌ Tenant not found. Please login again.</div>`;
    setTimeout(() => window.location.href = "login.html", 1500);
    return;
  }

  try {
    // Example: Load waybills for tenant
    const q = query(collection(db, "waybills"), where("tenantId","==",tenantId));
    const snapshot = await getDocs(q);
    let html = `<div class="panel"><h2>Waybills for tenant: ${tenantId}</h2><ul>`;
    snapshot.forEach(doc => {
      const data = doc.data();
      html += `<li>${data.Waybill || data.waybillNo || "Unnamed"} | ${data.sender || ""} → ${data.receiver || ""}</li>`;
    });
    html += "</ul></div>";
    panel.innerHTML = html;
  } catch(err) {
    panel.innerHTML = `<div class="panel" style="color:red;">❌ Error loading data: ${err.message}</div>`;
  }
}

// --- Initialize ---
loadTenantData();
</script>

</body>
</html>
