<div class="panel">
  <h2>Import CSV Files</h2>

  <!-- Manifest CSV -->
  <form id="manifest-form" enctype="multipart/form-data">
    <label>Parcel Manifest CSV:</label>
    <input type="file" name="file" required>
    <button type="submit">Process Manifest</button>
  </form>

  <!-- Scan CSV -->
  <form id="scan-form" enctype="multipart/form-data">
    <label>Parcel Scan CSV:</label>
    <input type="file" name="file" required>
    <button type="submit">Process Scan</button>
  </form>

  <div id="import-feedback" style="margin-top:10px;"></div>
</div>

<script>
const feedback = document.getElementById("import-feedback");

// Manifest
document.getElementById("manifest-form").addEventListener("submit", async (e) => {
  e.preventDefault();
  const formData = new FormData(e.target);
  const res = await fetch("/api/parcels/import-manifest", {
    method: "POST",
    body: formData,
  });
  const data = await res.json();
  feedback.innerHTML = data.success
    ? `✅ Manifest imported: ${data.inserted} parcels`
    : `❌ Error: ${data.error}`;
  if (data.success) showPanel("view-waybills.html");
});

// Scan
document.getElementById("scan-form").addEventListener("submit", async (e) => {
  e.preventDefault();
  const formData = new FormData(e.target);
  const res = await fetch("/api/parcels/import-scan", {
    method: "POST",
    body: formData,
  });
  const data = await res.json();
  feedback.innerHTML = data.success
    ? `✅ Scan CSV processed: ${data.updated} parcels updated`
    : `❌ Error: ${data.error}`;
  if (data.success) showPanel("view-waybills.html");
});
</script>
